<!--
  mermaid-js loader
  based from https://github.com/cotes2020/jekyll-theme-chirpy/blob/48f14e39ac81bbfb3b9913ea3ee789d775b2d1ae/_includes/mermaid.html
-->

<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

  $(document).ready(function(){
    /* Create mermaid tag */
    $("pre").has(".language-mermaid").each(function(){
      let svgCode = $(this).children().html();
      $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`);
      $(this).remove();
    });

    mermaid.run();  /* render class=.mermaid */

  });

  let initTheme = "default";

  if ($("html[data-mode=dark]").length > 0
    || ($("html[data-mode]").length == 0
    && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
    initTheme = "dark";
  }

  let mermaidConf = {
    theme: initTheme,   /* <default|dark|forest|neutral> */
    startOnLoad: false,  /* start render when mermaid on lodad. see https://mermaid.js.org/config/usage.html#using-mermaid-run */
  };

  mermaid.initialize(mermaidConf);  /* will render on ready */ 
</script>
